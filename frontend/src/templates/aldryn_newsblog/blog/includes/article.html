{% load i18n apphooks_config_tags cms_tags sekizai_tags staticfiles thumbnail %}
{% load url from future %}

<article class="aldryn-newsblog-article
{% if article.is_featured %} aldryn-newsblog-featured{% endif %}
{% if not article.published %} unpublished{% endif %}
{% if article.future %} future{% endif %}">

    {% block newsblog_visual %}
        {% if article.featured_image_id %}
            {% if not detail_view %}<a href="{{ article.get_absolute_url }}">{% endif %}
            <div class="cover-image" style="background-image: url({% thumbnail article.featured_image.image 800x450 crop subject_location=article.featured_image.subject_location %});"></div>
            {% if not detail_view %}</a>{% endif %}
        {% endif %}
    {% endblock newsblog_visual %}

    <div class="content">

        {% block newsblock_title %}
            <h2>
                {% if not detail_view %}
                    <a href="{% namespace_url 'article-detail' article.slug namespace=namespace default='' %}">{% render_model article "title" %}</a>
                {% else %}
                    {% render_model article "title" %}
                {% endif %}
            </h2>
        {% endblock newsblock_title %}

            {% if not detail_view %}
                <div class="lead-in">
                    {% render_model article "lead_in" "" "" "truncatewords:'20'" %}
                </div>
            {% else %}
                <div class="lead-in">
                    {% render_model article "lead_in" %}
                </div>
            {% endif %}

        {% block newsblog_meta %}
            {% include "aldryn_newsblog/includes/author.html" with author=article.author %}

            {% if article.tags and detail_view %}
                <p class="tags">
                    {% for tag in article.tags.all %}
                        <a href="{% namespace_url 'article-list-by-tag' tag=tag.slug namespace=namespace default='' %}">{{ tag.name }}</a>
                    {% endfor %}
                </p>
            {% endif %}

            {% block newsblog_categories %}
                {% if article.categories %}
                    <p class="categories">
                        {% for category in article.categories.all %}
                            <a href="{% namespace_url 'article-list-by-category' category.slug namespace=namespace default='' %}">{{ category.name }}</a>
                            {% if not forloop.last %}, {% endif %}
                        {% endfor %}
                    </p>
                {% endif %}
            {% endblock newsblog_categories %}
        {% endblock newsblog_meta %}
    </div>
</article>

{% addtoblock "css" %}
    <link rel="stylesheet" href="{% static 'css/aldryn-newsblog/article.css' %}">{% endaddtoblock %}
